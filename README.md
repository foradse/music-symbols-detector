# Music Symbols Recognition System

## Описание

**Music Symbols Recognition System** — это комплексный проект для автоматизации распознавания музыкальных символов на изображениях нотных листов с помощью методов компьютерного зрения и нейросетей.

Проект включает:
- инструменты для ручной разметки и подготовки датасета,
- модули для препроцессинга и нарезки изображений,
- инфраструктуру для обучения и тестирования моделей,
- (в перспективе) сервисы для инференса и интеграции с внешними приложениями.

---

## Цели проекта
- Автоматизировать распознавание нотных символов (диезы, бемоли, ключи, паузы и др.) на сканах и фотографиях нот.
- Обеспечить полный цикл: от сбора и разметки данных до обучения и применения нейросетевых моделей.
- Создать расширяемую платформу для исследований в области Optical Music Recognition (OMR).

---

## Архитектура проекта

Ниже представлена структура (архитектурное дерево) проекта с пояснениями по основным этапам пайплайна:

```
project-root/
├── input/                # Исходные изображения для разметки и обучения
├── input-storage/        # Временное хранилище (резервные копии, тестовые данные)
├── output/               # Результаты ручной разметки
│   ├── positive/         # Классы размеченных символов (diez, flat, ...)
│   ├── negative/         # Негативные примеры
│   └── labels.txt        # Аннотации: имя файла, класс (англ.)
│   └── clear_output.py   # Скрипт для очистки результатов разметки
├── symbol_labeler/       # Инструменты для ручной сортировки и аннотирования
│   ├── labeler.py        # Графическая утилита для разметки (интерфейс на русском)
│   ├── symbols.txt       # Список классов для разметки (русские названия)
│   └── class_map.txt     # Соответствие: русское название → английское имя папки/класса
├── recognize/            # Модули и данные для обучения, тестирования и инференса моделей
│   └── ...               # (Планируется) скрипты, модели, результаты
└── ...                   # Прочие служебные и будущие модули
```

**Основные этапы пайплайна:**
1. Сбор и ручная разметка данных (`input/` → `output/` через `symbol_labeler/labeler.py`)
2. (Планируется) Препроцессинг и автоматическая нарезка
3. Формирование датасета для обучения/тестирования (`output/` → `recognize/`)
4. (Планируется) Обучение, инференс, интеграция с внешними сервисами

---

## Инструкция по использованию (разметка и подготовка данных)

### 1. Подготовка данных
- Поместите неразмеченные изображения в папку `input/`.
- Для временного хранения используйте `input-storage/`.

### 2. Ручная разметка
- Запустите:
  ```bash
  python symbol_labeler/labeler.py
  ```
- Используйте горячие клавиши для сортировки по классам (см. `symbols.txt`).
- После разметки изображения автоматически перемещаются в `output/positive/<класс>/` или `output/negative/`.
- Аннотации сохраняются в `output/labels.txt`.

### 3. Очистка результатов (по необходимости)
- Для сброса состояния используйте:
  ```bash
  python output/clear_output.py
  ```

### 4. Сборка датасета для обучения
- После разметки используйте содержимое `output/` для формирования обучающей и тестовой выборки.
- Для интеграции с ML-скриптами используйте папку `recognize/`.

---

## symbols.txt
- Список всех классов для разметки (по одному в строке).
- Для добавления нового класса просто добавьте его название в этот файл.

---

## class_map.txt
- Файл соответствий между русскими названиями классов (для интерфейса) и английскими идентификаторами (для структуры папок и аннотаций). Формат:
```
Русское название:английское_имя
```
Пример:
```
Диез:diez
Бемоль:flat
...
```

---

## Частые ошибки и рекомендации
- **Файл не отображается в интерфейсе:** проверьте расширение и расположение.
- **Файл не перемещается:** проверьте права на запись в `output/`.
- **Аннотация не добавляется:** убедитесь, что `labels.txt` не открыт в другой программе.
- **Потеря данных при отмене:** восстановить удалённый файл невозможно.

---

## Планы по развитию
- Реализация автоматической нарезки нотных строк на символы (модуль crop_symbols.py).
- Разработка и интеграция нейросетевых моделей для классификации и локализации символов.
- Поддержка инференса и API для внешних приложений.
- Расширение набора классов и автоматизация аугментаций.

---

## Расширяемость и поддержка
- Проект легко расширяется: добавляйте новые классы в `symbols.txt`, новые изображения в `input/`.
- Для интеграции с ML-пайплайном используйте папку `recognize/`.
- Все скрипты написаны на Python и не требуют специфических зависимостей, кроме стандартных библиотек и Pillow.

---

## Контакты и поддержка
Если у вас возникли вопросы, предложения или требуется помощь с использованием проекта — обращайтесь к автору или создайте issue в репозитории.

---

## Служебные скрипты

### clear_output.py

Скрипт `output/clear_output.py` предназначен для полной очистки папки `output/` от всех файлов и папок, кроме служебных файлов `.gitkeep` и самого скрипта `clear_output.py`.

**Использование:**

```bash
python output/clear_output.py
```

- После запуска все размеченные изображения, аннотации и подпапки в `output/` будут удалены.
- Скрипт полезен для сброса состояния перед новой разметкой или тестированием.
- **Внимание:** восстановить удалённые данные будет невозможно!

---


