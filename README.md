# music-symbols-detector

Распознавание и нарезка нотных символов с помощью OpenCV.

---

## Как

### 1. Подготовь изображения
- Сохрани скриншоты или фотографии нот в папку `input/`
- Поддерживаются форматы: `.png`, `.jpg`, `.jpeg`, `.bmp`
- Можно использовать как одиночные символы, так и целые строки — программа сама нарежет фрагменты.

### 2. Установи зависимости
```sh
pip install opencv-python numpy
```

### 3. Запусти автонарезку
```sh
python part_cut.py --input input --output output/parts --prefix myprefix_
```

Появятся папки:
- `positive/[класс]/` — распознанные символы
- `unknown/unknown/` — нераспознанные
- `debug/` — изображения с рамками и подписями классов
- `annotations.txt` — координаты всех фрагментов

---

## Как это работает
- Используется OpenCV для нахождения контуров.
- Размер и пропорции каждого фрагмента сравниваются с правилами (`SYMBOL_CLASSES`).
- Для диеза применяется дополнительная проверка по линиям (HoughLines).
- Всё автоматически сортируется и сохраняется.

---

## Структура проекта
```
recognize/
├── positive_images/        # вручную собранные позитивные примеры
│   └── clef_g/, diez/, ...
├── negative_images/        # вручную собранные негативные примеры
├── annotations/            # вручную или автоматически размеченные координаты
├── samples/                # временные файлы для обучения
├── classifier/             # обученные XML-файлы
├── results/                # результаты распознавания
input/                      # изображения для автонарезки
output/parts/               # результат нарезки и аннотации
```

---

## Формат аннотаций
Файл: `output/parts/annotations.txt`
```
[класс]/[имя_фрагмента] x y w h
```
Пример:
```
diez/diez_01.png 12 15 33 40
```

---

## Цель проекта
- Подготовить датасет из 35 классов нотных символов
- Для каждого: минимум 30 позитивных и минимум 100 негативных изображений
- Разметить координаты каждого элемента

---

## Распределение ролей
**Нарезчики:**
- Нарезать изображения и сохранять в `positive_images/[класс]/`
- Собирать не содержащие символов — в `negative_images/[класс]/`
- Именовать по шаблону: `001.jpg`, `002.jpg`, ...

**Техническая команда:**
- Проверка структуры
- Создание `positives.txt`, `negatives.txt`
- Генерация `.vec` через `opencv_createsamples`
- Обучение модели через `opencv_traincascade`

---

## Советы
- Лучше использовать чёткие изображения, 1 символ на фоне
- Размер символа — от 30×30 до 100×100 пикселей
- В `unknown` попадают фрагменты, не подходящие ни под один фильтр
- Если не распознаётся нужный символ — обнови фильтр в `SYMBOL_CLASSES`

---

## Частые ошибки
- Файл в `unknown`, потому что:
  - Контур слишком маленький/большой
  - Не подходит под правила фильтра
- `annotations.txt` пустой — нет подходящих фрагментов
- Папки не отображаются в GitHub — добавь в них `.gitkeep`


